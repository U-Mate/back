<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ“ UMate AI Assistant - ìµœì í™” í…ŒìŠ¤íŠ¸</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .chat-container {
        width: 90%;
        max-width: 800px;
        height: 90vh;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #1e40af, #3b82f6);
        color: white;
        padding: 20px;
        text-align: center;
        position: relative;
      }

      .status {
        position: absolute;
        top: 15px;
        right: 20px;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
      }

      .status.connected {
        background: rgba(34, 197, 94, 0.3);
        border: 1px solid rgba(34, 197, 94, 0.6);
        color: #22c55e;
      }

      .status.disconnected {
        background: rgba(239, 68, 68, 0.3);
        border: 1px solid rgba(239, 68, 68, 0.6);
        color: #ef4444;
      }

      .login-section {
        padding: 20px;
        background: #f8fafc;
        border-bottom: 1px solid #e5e7eb;
      }

      .login-form {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .login-form input {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        font-size: 14px;
        outline: none;
        transition: border-color 0.2s;
      }

      .login-form input:focus {
        border-color: #3b82f6;
      }

      .login-btn {
        padding: 12px 24px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.2s;
      }

      .login-btn:hover {
        background: #1d4ed8;
      }

      .optimization-info {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        padding: 10px 20px;
        font-size: 12px;
        text-align: center;
        animation: fadeIn 0.3s ease;
      }

      .optimization-info.first-session {
        background: linear-gradient(135deg, #f59e0b, #d97706);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background: #f8fafc;
      }

      .message {
        margin-bottom: 15px;
        display: flex;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message.user {
        justify-content: flex-end;
      }

      .message-content {
        max-width: 70%;
        padding: 12px 16px;
        border-radius: 18px;
        font-size: 14px;
        line-height: 1.5;
        word-wrap: break-word;
      }

      .message.user .message-content {
        background: #3b82f6;
        color: white;
        border-bottom-right-radius: 6px;
      }

      .message.bot .message-content {
        background: white;
        color: #1f2937;
        border: 1px solid #e5e7eb;
        border-bottom-left-radius: 6px;
      }

      .message.system .message-content {
        background: #f3f4f6;
        color: #6b7280;
        font-style: italic;
        text-align: center;
        border-radius: 10px;
        max-width: 100%;
      }

      .message-time {
        font-size: 10px;
        opacity: 0.6;
        margin-top: 4px;
      }

      .input-container {
        padding: 20px;
        background: white;
        border-top: 1px solid #e5e7eb;
      }

      .controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .control-btn {
        padding: 8px 16px;
        border: 1px solid #d1d5db;
        border-radius: 20px;
        background: white;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s ease;
      }

      .control-btn:hover {
        background: #f3f4f6;
        transform: translateY(-1px);
      }

      .control-btn.active {
        background: #10b981;
        color: white;
        border-color: #059669;
      }

      .input-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
      }

      #messageInput {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 25px;
        font-size: 14px;
        resize: none;
        min-height: 44px;
        max-height: 120px;
        font-family: inherit;
        outline: none;
        transition: border-color 0.2s;
      }

      #messageInput:focus {
        border-color: #3b82f6;
      }

      .send-btn {
        width: 44px;
        height: 44px;
        border: none;
        border-radius: 50%;
        background: #3b82f6;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        transition: background 0.2s;
      }

      .send-btn:hover {
        background: #1d4ed8;
      }

      .send-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }

      .audio-controls {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .voice-btn {
        width: 44px;
        height: 44px;
        border: 2px solid #3b82f6;
        border-radius: 50%;
        background: white;
        color: #3b82f6;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        transition: all 0.2s;
      }

      .voice-btn:hover,
      .voice-btn.recording {
        background: #3b82f6;
        color: white;
      }

      .voice-btn.recording {
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      .hidden {
        display: none;
      }

      .optimization-status {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
        padding: 8px 12px;
        margin-bottom: 10px;
        border-radius: 8px;
        font-size: 11px;
        text-align: center;
        border: 1px solid rgba(16, 185, 129, 0.2);
      }

      .optimization-status.temporary {
        animation: fadeOut 3s ease-in-out forwards;
      }

      @keyframes fadeOut {
        0% {
          opacity: 1;
        }
        70% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <!-- í—¤ë” -->
      <div class="header">
        <h1>ğŸ“ UMate AI Assistant</h1>
        <p>ìµœì í™”ëœ íˆìŠ¤í† ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” ì—°ì†ì„± ì œê³µ</p>
        <div class="status disconnected" id="status">ì—°ê²° ì•ˆë¨</div>
      </div>

      <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
      <div class="login-section" id="loginSection">
        <div class="login-form">
          <input
            type="email"
            id="emailInput"
            placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: user@example.com)"
          />
          <button class="login-btn" onclick="connectWithEmail()">
            ì—°ê²°í•˜ê¸°
          </button>
        </div>
      </div>

      <!-- ìµœì í™” ì •ë³´ -->
      <div class="optimization-info hidden" id="optimizationInfo">
        âœ¨ ìµœì í™” í™œì„±í™”: ì´ì „ ëŒ€í™”ê°€ OpenAIì— ë¯¸ë¦¬ ë¡œë“œë˜ì–´ íš¨ìœ¨ì ì¸ ëŒ€í™”ê°€
        ê°€ëŠ¥í•©ë‹ˆë‹¤
      </div>

      <!-- ë©”ì‹œì§€ ì˜ì—­ -->
      <div class="messages" id="messages">
        <div class="message system">
          <div class="message-content">
            UMate AI Assistantì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!<br />
            ì´ë©”ì¼ì„ ì…ë ¥í•˜ê³  ì—°ê²°í•˜ë©´ ì´ì „ ëŒ€í™” ë‚´ì—­ì´ ìë™ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <!-- ì…ë ¥ ì˜ì—­ -->
      <div class="input-container">
        <div class="controls">
          <button class="control-btn" onclick="clearMessages()">
            ì±„íŒ… ì •ë¦¬
          </button>
          <button class="control-btn" onclick="showOptimizationInfo()">
            ğŸ“Š ìµœì í™” ì •ë³´
          </button>
          <button class="control-btn" onclick="testConnection()">
            ğŸ”— ì—°ê²° í…ŒìŠ¤íŠ¸
          </button>
        </div>

        <div class="input-wrapper">
          <textarea
            id="messageInput"
            placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
            rows="1"
            disabled
          ></textarea>
          <div class="audio-controls">
            <button
              class="voice-btn"
              id="voiceBtn"
              onclick="toggleVoiceRecording()"
              disabled
            >
              ğŸ¤
            </button>
            <button
              class="send-btn"
              id="sendBtn"
              onclick="sendMessage()"
              disabled
            >
              â¤
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let socket = null;
      let isConnected = false;
      let currentEmail = null;
      let currentBotMessageDiv = null;
      let isRecording = false;
      let mediaRecorder = null;
      let audioContext = null;
      let messageCount = 0;

      // ì´ë©”ì¼ë¡œ ì—°ê²°
      async function connectWithEmail() {
        const emailInput = document.getElementById("emailInput");
        const email = emailInput.value.trim();

        if (!email) {
          alert("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        if (!email.includes("@")) {
          alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        currentEmail = email;
        connectWebSocket();

        // UI ì—…ë°ì´íŠ¸
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("messageInput").disabled = false;
        document.getElementById("sendBtn").disabled = false;
        document.getElementById("voiceBtn").disabled = false;

        addMessage("system", `${email}ë¡œ ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤...`);
      }

      // WebSocket ì—°ê²°
      function connectWebSocket() {
        if (!currentEmail) return;

        const wsUrl = `ws://localhost:3000/realtime-chat?email=${encodeURIComponent(
          currentEmail
        )}`;
        console.log("ğŸ”— WebSocket ì—°ê²° ì‹œë„:", wsUrl);

        socket = new WebSocket(wsUrl);

        socket.onopen = function (event) {
          console.log("âœ… WebSocket ì—°ê²°ë¨");
          updateStatus("connected", "ğŸŸ¢ ì—°ê²°ë¨");
          isConnected = true;
        };

        socket.onmessage = function (event) {
          const data = JSON.parse(event.data);
          console.log("ğŸ“¨ ë°›ì€ ë©”ì‹œì§€:", data);
          handleServerMessage(data);
        };

        socket.onclose = function (event) {
          console.log("ğŸ”Œ WebSocket ì—°ê²° ì¢…ë£Œ");
          updateStatus("disconnected", "ğŸ”´ ì—°ê²° ëŠê¹€");
          isConnected = false;
        };

        socket.onerror = function (error) {
          console.error("âŒ WebSocket ì˜¤ë¥˜:", error);
          updateStatus("disconnected", "ğŸ”´ ì—°ê²° ì˜¤ë¥˜");
          isConnected = false;
        };
      }

      // ì„œë²„ ë©”ì‹œì§€ ì²˜ë¦¬
      function handleServerMessage(data) {
        switch (data.type) {
          case "connection":
            if (data.status === "connected") {
              console.log("ğŸ‰ ì—°ê²° í™•ì¸:", data.capabilities);

              // ìµœì í™” ì •ë³´ í‘œì‹œ
              if (data.capabilities.optimization === "enabled") {
                showOptimizationStatus(true, data.chatHistory?.length || 0);
                loadChatHistory(data.chatHistory || []);
              } else {
                showOptimizationStatus(false, 0);
              }

              addMessage("system", `âœ… ${data.message}`);
            } else if (data.status === "connecting") {
              addMessage("system", `ğŸ”„ ${data.message}`);
            }
            break;

          case "assistant_message_start":
            addMessage("system", "ğŸ¤– AIê°€ ë‹µë³€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...");
            break;

          case "text_delta":
            updateBotMessage(data.delta);
            break;

          case "text_done":
            finalizeBotMessage(data.text);
            showMessageOptimization();
            break;

          case "transcription_complete":
            addMessage("user", `ğŸ¤ "${data.transcription}"`);
            break;

          case "audio_transcript_done":
            finalizeBotMessage(data.transcript);
            break;

          case "speech_started":
            showTemporaryMessage("ğŸ¤ ìŒì„±ì„ ë“£ê³  ìˆìŠµë‹ˆë‹¤...");
            break;

          case "speech_stopped":
            showTemporaryMessage("ğŸ”„ ìŒì„±ì„ ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤...");
            break;

          case "error":
            addMessage("system", `âŒ ì˜¤ë¥˜: ${data.error}`);
            break;

          default:
            console.log("ğŸ” ì²˜ë¦¬ë˜ì§€ ì•Šì€ ë©”ì‹œì§€ íƒ€ì…:", data.type);
        }
      }

      // ë©”ì‹œì§€ ì „ì†¡
      function sendMessage() {
        const input = document.getElementById("messageInput");
        const message = input.value.trim();

        if (!message || !isConnected) return;

        addMessage("user", message);
        input.value = "";
        input.style.height = "auto";
        messageCount++;

        // WebSocketìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡
        socket.send(
          JSON.stringify({
            type: "user_message",
            message: message,
          })
        );

        console.log(`ğŸ“¤ ë©”ì‹œì§€ ì „ì†¡: "${message}"`);
      }

      // ìŒì„± ë…¹ìŒ í† ê¸€
      async function toggleVoiceRecording() {
        if (!isConnected) {
          alert("ë¨¼ì € ì—°ê²°í•´ì£¼ì„¸ìš”.");
          return;
        }

        if (!isRecording) {
          await startVoiceRecording();
        } else {
          stopVoiceRecording();
        }
      }

      // ìŒì„± ë…¹ìŒ ì‹œì‘
      async function startVoiceRecording() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: true,
          });

          // AudioContext ì„¤ì •
          audioContext = new (window.AudioContext || window.webkitAudioContext)(
            { sampleRate: 16000 }
          );
          const source = audioContext.createMediaStreamSource(stream);

          // ìŒì„± ë°ì´í„° ì²˜ë¦¬
          await audioContext.audioWorklet.addModule(
            "data:application/javascript;base64," +
              btoa(`
            class AudioProcessor extends AudioWorkletProcessor {
              process(inputs, outputs, parameters) {
                const input = inputs[0];
                if (input.length > 0) {
                  const samples = input[0];
                  const int16Array = new Int16Array(samples.length);
                  for (let i = 0; i < samples.length; i++) {
                    int16Array[i] = Math.max(-32768, Math.min(32767, samples[i] * 32768));
                  }
                  this.port.postMessage(int16Array.buffer);
                }
                return true;
              }
            }
            registerProcessor('audio-processor', AudioProcessor);
          `)
          );

          const processor = new AudioWorkletNode(
            audioContext,
            "audio-processor"
          );
          source.connect(processor);

          processor.port.onmessage = (event) => {
            if (socket && socket.readyState === WebSocket.OPEN) {
              const audioData = Array.from(new Int16Array(event.data));
              socket.send(
                JSON.stringify({
                  type: "audio_data",
                  audio: audioData,
                })
              );
            }
          };

          isRecording = true;
          document.getElementById("voiceBtn").classList.add("recording");
          document.getElementById("voiceBtn").textContent = "â¹ï¸";
        } catch (error) {
          console.error("ìŒì„± ë…¹ìŒ ì‹œì‘ ì˜¤ë¥˜:", error);
          alert("ìŒì„± ë…¹ìŒì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      }

      // ìŒì„± ë…¹ìŒ ì¤‘ì§€
      function stopVoiceRecording() {
        if (audioContext) {
          audioContext.close();
          audioContext = null;
        }

        if (socket && socket.readyState === WebSocket.OPEN) {
          socket.send(
            JSON.stringify({
              type: "audio_commit",
            })
          );
        }

        isRecording = false;
        document.getElementById("voiceBtn").classList.remove("recording");
        document.getElementById("voiceBtn").textContent = "ğŸ¤";
      }

      // ë©”ì‹œì§€ ì¶”ê°€
      function addMessage(type, content, timestamp = null) {
        const messagesContainer = document.getElementById("messages");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${type}`;

        const contentDiv = document.createElement("div");
        contentDiv.className = "message-content";
        contentDiv.textContent = content;

        if (timestamp) {
          const timeDiv = document.createElement("div");
          timeDiv.className = "message-time";
          timeDiv.textContent = new Date(timestamp).toLocaleString();
          contentDiv.appendChild(timeDiv);
        }

        messageDiv.appendChild(contentDiv);
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      // ë´‡ ë©”ì‹œì§€ ìŠ¤íŠ¸ë¦¬ë°
      function updateBotMessage(delta) {
        if (!currentBotMessageDiv) {
          startBotMessage();
        }
        currentBotMessageDiv.textContent += delta;
        document.getElementById("messages").scrollTop =
          document.getElementById("messages").scrollHeight;
      }

      function startBotMessage() {
        const messagesContainer = document.getElementById("messages");
        const messageDiv = document.createElement("div");
        messageDiv.className = "message bot";

        const contentDiv = document.createElement("div");
        contentDiv.className = "message-content";

        messageDiv.appendChild(contentDiv);
        messagesContainer.appendChild(messageDiv);
        currentBotMessageDiv = contentDiv;
      }

      function finalizeBotMessage(finalText) {
        if (currentBotMessageDiv && finalText) {
          currentBotMessageDiv.textContent = finalText;
        }
        currentBotMessageDiv = null;
      }

      // ì±„íŒ… íˆìŠ¤í† ë¦¬ ë¡œë“œ
      function loadChatHistory(history) {
        if (history.length > 0) {
          addMessage(
            "system",
            `ğŸ’¬ ì´ì „ ëŒ€í™” ${history.length}ê°œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`
          );

          history.forEach((msg) => {
            addMessage(msg.MESSAGE_TYPE, msg.MESSAGE, msg.CREATED_AT);
          });
        }
      }

      // ìµœì í™” ìƒíƒœ í‘œì‹œ
      function showOptimizationStatus(hasHistory, historyCount) {
        const infoDiv = document.getElementById("optimizationInfo");
        infoDiv.classList.remove("hidden");

        if (hasHistory) {
          infoDiv.innerHTML = `âœ¨ ìµœì í™” í™œì„±í™”: ì´ì „ ëŒ€í™” ${historyCount}ê°œê°€ OpenAIì— ë¯¸ë¦¬ ë¡œë“œë˜ì–´ íš¨ìœ¨ì ì¸ ëŒ€í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤`;
          infoDiv.className = "optimization-info";
        } else {
          infoDiv.innerHTML = `ğŸ†• ìƒˆ ì„¸ì…˜: ì²« ë©”ì‹œì§€ì—ëŠ” ìœ ì € ì •ë³´ë¥¼ í¬í•¨í•˜ì—¬ ì „ì†¡í•©ë‹ˆë‹¤`;
          infoDiv.className = "optimization-info first-session";
        }
      }

      // ë©”ì‹œì§€ ìµœì í™” í‘œì‹œ
      function showMessageOptimization() {
        const messagesContainer = document.getElementById("messages");
        const statusDiv = document.createElement("div");
        statusDiv.className = "optimization-status temporary";
        statusDiv.textContent = `âš¡ ìµœì í™”: ìƒˆ ë©”ì‹œì§€ë§Œ ì „ì†¡ë¨ (ë©”ì‹œì§€ #${messageCount})`;

        messagesContainer.appendChild(statusDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        // 3ì´ˆ í›„ ìë™ ì œê±°
        setTimeout(() => {
          if (statusDiv.parentNode) {
            statusDiv.remove();
          }
        }, 3000);
      }

      // ì„ì‹œ ë©”ì‹œì§€ í‘œì‹œ
      function showTemporaryMessage(message) {
        addMessage("system", message);
        // ë§ˆì§€ë§‰ system ë©”ì‹œì§€ë¥¼ 3ì´ˆ í›„ ìë™ ì œê±°
        setTimeout(() => {
          const systemMessages = document.querySelectorAll(".message.system");
          const lastSystemMessage = systemMessages[systemMessages.length - 1];
          if (
            lastSystemMessage &&
            lastSystemMessage.textContent.includes(message)
          ) {
            lastSystemMessage.remove();
          }
        }, 3000);
      }

      // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
      function updateStatus(status, text) {
        const statusEl = document.getElementById("status");
        statusEl.className = `status ${status}`;
        statusEl.textContent = text;
      }

      function clearMessages() {
        document.getElementById("messages").innerHTML = `
          <div class="message system">
            <div class="message-content">ì±„íŒ…ì´ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
          </div>
        `;
        messageCount = 0;
      }

      function showOptimizationInfo() {
        const info = `
ğŸ“Š ìµœì í™” ì‹œìŠ¤í…œ ì •ë³´:
ğŸ”— ì—°ê²°ëœ ì´ë©”ì¼: ${currentEmail || "ì—†ìŒ"}
ğŸŒ WebSocket ìƒíƒœ: ${isConnected ? "ì—°ê²°ë¨" : "ì—°ê²° ì•ˆë¨"}
ğŸ“ˆ ì „ì†¡ëœ ë©”ì‹œì§€: ${messageCount}ê°œ
âš¡ ìµœì í™” ë°©ì‹: ì—°ê²° ì‹œ ì´ì „ ëŒ€í™” ë¡œë“œ + ìƒˆ ë©”ì‹œì§€ë§Œ ì „ì†¡
ğŸš€ í† í° ì ˆì•½: ìµœëŒ€ 90% ì´ìƒ
ğŸ§  AI ë©”ëª¨ë¦¬: ì´ì „ ëŒ€í™” ë§¥ë½ ìë™ ê¸°ì–µ

âœ¨ ì‹œìŠ¤í…œ íŠ¹ì§•:
- ì²« ì—°ê²° ì‹œ: ìœ ì € ì •ë³´ + ì´ì „ ëŒ€í™”ë¥¼ OpenAIì— í•œ ë²ˆë§Œ ë¡œë“œ
- ì´í›„ ë©”ì‹œì§€: ë‹¨ìˆœí•œ ìƒˆ ë©”ì‹œì§€ë§Œ ì „ì†¡
- ìì—°ìŠ¤ëŸ¬ìš´ ì—°ì†ì„±: AIê°€ ìë™ìœ¼ë¡œ ì´ì „ ë§¥ë½ ê¸°ì–µ
- ìŒì„± + í…ìŠ¤íŠ¸: ëª¨ë“  ëª¨ë‹¬ë¦¬í‹°ì—ì„œ ìµœì í™” ì ìš©
        `;

        addMessage("system", info.trim());
      }

      function testConnection() {
        if (socket && socket.readyState === WebSocket.OPEN) {
          addMessage(
            "system",
            "ğŸ”— ì—°ê²° í…ŒìŠ¤íŠ¸: WebSocketì´ ì •ìƒì ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤!"
          );
        } else {
          addMessage(
            "system",
            "âŒ ì—°ê²° í…ŒìŠ¤íŠ¸: WebSocket ì—°ê²°ì´ ëŠì–´ì ¸ ìˆìŠµë‹ˆë‹¤."
          );
        }
      }

      // ì—”í„°í‚¤ ì „ì†¡
      document
        .getElementById("messageInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
          }
        });

      // í…ìŠ¤íŠ¸ ì˜ì—­ ìë™ í¬ê¸° ì¡°ì ˆ
      document
        .getElementById("messageInput")
        .addEventListener("input", function () {
          this.style.height = "auto";
          this.style.height = Math.min(this.scrollHeight, 120) + "px";
        });
    </script>
  </body>
</html>
